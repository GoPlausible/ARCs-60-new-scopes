---
arc: 13
title: Web Extension Wallet Interface
description: A common interface for multiple web extension wallets to interact with dapps.
author: Kieran O'Neill (@kieranroneill)
discussions-to: <URL>
status: Draft
type: Standards Track
category: Interface
created: 2023-12-18
requires (*optional): <ARC number(s)>
---

## Abstract

Building off of the previous ARCs relating to; wallet transaction signing ([ARC-0005](./arc-0005.md#specification)), wallet address discovery ([ARC-0006](./arc-0006.md#specification)), wallet transaction network posting ([ARC-0007](./arc-0007.md#specification)) and wallet transaction signing & posting ([ARC-0008](./arc-0008.md#specification)), this proposal aims to extend and comprehensively outline a common interface between multiple web extension wallets and dapps by utilizing the pub/sub semantics of the [BroadcastChannel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API).

## Motivation

Two common patterns have emerged amongst web extension wallets:

| Description                                                                                                                                                                                                                                                                                                                                                                                                                          | Benefits                                                                                                                                                                                                                                                                                                                    | Drawbacks                                                                                                                                                                                                                        |
|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| The global `window.algorand` object is overwritten by an injected script from a web extension's content script. This overwritten object will provide features that allows the dapp to interact with the wallet which may or may not conform to previous ARCs ([ARC-0005](./arc-0005.md#specification), [ARC-0006](./arc-0005.md#specification), [ARC-0007](./arc-0007.md#specification) or [ARC-0008](./arc-0008.md#specification)). | - Dapps will not have to install any external SDKs<br/>- Dapps do not need to know which wallet the user is using (if the injected wallet conforms to [ARC-0005](./arc-0005.md#specification), [ARC-0006](./arc-0005.md#specification), [ARC-0007](./arc-0007.md#specification) or [ARC-0008](./arc-0008.md#specification)) | - In the instance of multiple web extension wallets, another wallet extension may overwrite this object.<br/>- Once overwritten, the `window.algorand` object will only service the last web extension wallet that overwrote it. |
| A wallet provides a separate SDK that is installed by a dapp to interact with the wallet.                                                                                                                                                                                                                                                                                                                                            | - Allows wallets full control over how dapps interact with wallets, ie. provide a bespoke UX.                                                                                                                                                                                                                               | - Dapps need to install each SDK separately, thereby increasing the amount of development time, and complexity, needed to implement each wallet separately.                                                                      |

While both patterns have merits, they can stumble when it comes to allowing dapps to be un-opinionated about what wallet the user intends to use. 

This proposal intends to outline a common interface that, at it's core, will subscribe to some fundamental goals:

1. Creating a common interface between dapps and wallets.
2. Allowing wallets to work in unison.
3. Full authority of wallet choice is in the hands the user.

## Specification

The key words "**MUST**", "**MUST NOT**", "**REQUIRED**", "**SHALL**", "**SHALL NOT**", "**SHOULD**", "**SHOULD NOT**", "**RECOMMENDED**", "**MAY**", and "**OPTIONAL**" in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC-2119</a>.

### Overview

The essence of the web extension wallet interface will lie in the simple messaging bus mechanism of the [BroadcastChannel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API).

A dapp will broadcast a message and any web extension wallet's [content scripts](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts) will listen for these broadcasted messages and act upon them, responding with another broadcast message that references the original request broadcast.

The dapp will, itself, listen to broadcasted responses from any web extension wallets.

![Simple BroadcastChannel API using web extensions](../assets/arc-0013/simple_message_bus.png)

### Setup

1. (**REQUIRED**) Both the dapp and the web extension wallet must create/join a broadcast channel with a common channel name:

```js
const channel = new BroadcastChannel('arc0013:channel');
```

> ⚠️ **NOTE:** Web extension wallets **MUST** create/join the `BroadcastChannel` in a content script.

### Message Reference Naming

In order for each message to be identifiable, each message **MUST** contain a `reference` property. Furthermore, this `reference` property **MUST** conform to the naming convention:

```
[standard]:[event_name]:[type]
```
where:
* `standard`:
    - **MUST** be `arc0013`
* `event_name`:
    - **MUST** be in snake case
* `type`:
    - **MUST** be one of `request` or `response`

This convention ensures that each message can be identified and handled.

### Messages API

#### Get Wallet

Usually called by a dapp to get responses of any available providers (web extension wallets).

**Request Payload**

```json
{
  "title": "Get Wallet Request Payload",
  "type": "object",
  "properties": {
    "messageId": {
      "type": "string",
      "description": "A globally unique identifier for the message"
    },
    "providerId": {
      "type": "string",
      "description": "A unique identifier for a provider (wallet)"
    },
    "reference": {
      "type": "string",
      "description": "Identifies the purpose of the message"
    }
  },
  "required": ["messageId", "reference"]
}
```
where:
* `messageId`:
  - **MUST** be a [UUIDv4](https://www.rfc-editor.org/rfc/rfc4122) compliant string
* `providerId`:
  - **MUST** be a [UUIDv4](https://www.rfc-editor.org/rfc/rfc4122) compliant string
  - **OPTIONAL** if omitted, all wallets **SHOULD** respond
* `reference`:
  - **MUST** be `arc0013:get_wallets:request`

**Response Payload**

```json
{
  "title": "Get Wallet Response Payload",
  "type": "object",
  "properties": {
    "messageId": {
      "type": "string",
      "description": "A globally unique identifier for the message"
    },
    "reference": {
      "type": "string",
      "description": "Identifies the purpose of the message"
    },
    "requestId": {
      "type": "string",
      "description": "The ID of the request message"
    }
  },
  "required": ["messageId", "reference", "requestId"]
}
```
where:
* `messageId`:
  - **MUST** be a [UUIDv4](https://www.rfc-editor.org/rfc/rfc4122) compliant string
* `reference`:
  - **MUST** be `arc0013:get_wallets:response`
* `requestId`:
  - **MUST** be the ID of the origin request message

> ⚠️ **NOTE:** If the `requestId` is missing, or does not match the ID of the origin request message, the response **SHOULD** be ignored.

#### Enable



**Request Payload**

```json
{
  "title": "Get Wallet Request Payload",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "A globally unique identifier that conforms to the UUIDv4 standard"
    },
    "reference": {
      "type": "string",
      "description": "The reference allows the client to identify the purpose of the message"
    }
  },
  "required": ["id", "reference"]
}
```
where:
* `id`:
    - **MUST** be a [UUIDv4](https://www.rfc-editor.org/rfc/rfc4122) compliant string
* `reference`:
    - **MUST** be `arc0013:get_wallets:request`

**Response Payload**

```json
{
  "title": "Get Wallet Response Payload",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "A globally unique identifier that conforms to the UUIDv4 standard"
    },
    "reference": {
      "type": "string",
      "description": "Identifies the purpose of the message"
    },
    "requestId": {
      "type": "string",
      "description": "The ID of the request message"
    },
  },
  "required": ["id", "reference", "requestId"]
}
```
where:
* `id`:
    - **MUST** be a [UUIDv4](https://www.rfc-editor.org/rfc/rfc4122) compliant string
* `reference`:
    - **MUST** be `arc0013:get_wallets:response`
* `requestId`:
    - **MUST** be the ID of the origin request message

> ⚠️ **NOTE:** If the `requestId` is missing, or does not match the ID of the origin request message, it **SHOULD** be ignored.

## Rationale
The rationale fleshes out the specification by describing what motivated the design and why particular design decisions were made. It should describe alternate designs that were considered and related work, e.g. how the feature is supported in other languages.

## Backwards Compatibility
All ARCs that introduce backwards incompatibilities must include a section describing these incompatibilities and their severity. The ARC must explain how the author proposes to deal with these incompatibilities. ARC submissions without a sufficient backwards compatibility treatise may be rejected outright.

## Test Cases
Test cases for an implementation are mandatory for ARCs that are affecting consensus changes.  If the test suite is too large to reasonably be included inline, then consider adding it as one or more files in `../assets/arc-####/`.

## Reference Implementation
An optional section that contains a reference/example implementation that people can use to assist in understanding or implementing this specification.  If the implementation is too large to reasonably be included inline, then consider adding it as one or more files in `../assets/arc-####/`.

## Security Considerations
All ARCs must contain a section that discusses the security implications/considerations relevant to the proposed change. Include information that might be important for security discussions, surfaces risks and can be used throughout the life cycle of the proposal. E.g. include security-relevant design decisions, concerns, important discussions, implementation-specific guidance and pitfalls, an outline of threats and risks and how they are being addressed. ARC submissions missing the "Security Considerations" section will be rejected. An ARC cannot proceed to status "Final" without a Security Considerations discussion deemed sufficient by the reviewers.

## Copyright
Copyright and related rights waived via <a href="https://creativecommons.org/publicdomain/zero/1.0/">CCO</a>.
